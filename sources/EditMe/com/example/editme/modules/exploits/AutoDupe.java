package com.example.editme.modules.exploits;

import com.example.editme.modules.Module;
import com.example.editme.settings.Setting;
import com.example.editme.util.client.EntityUtil;
import com.example.editme.util.setting.SettingsManager;
import java.util.Iterator;
import net.minecraft.client.Minecraft;
import net.minecraft.client.gui.inventory.GuiScreenHorseInventory;
import net.minecraft.entity.Entity;
import net.minecraft.entity.EntityLivingBase;
import net.minecraft.entity.passive.AbstractChestHorse;
import net.minecraft.init.Items;
import net.minecraft.inventory.ClickType;
import net.minecraft.inventory.Container;
import net.minecraft.inventory.Slot;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketUseEntity;
import net.minecraft.network.play.client.CPacketEntityAction.Action;
import net.minecraft.util.EnumHand;
import net.minecraft.util.math.Vec3d;

@Module.Info(
   name = "AutoDupe",
   category = Module.Category.EXPLOITS,
   description = "Automatically Dupes"
)
public class AutoDupe extends Module {
   private Setting pitch = this.register(SettingsManager.integerBuilder("Pitch").withValue((int)90).withVisibility(this::lambda$new$4).build());
   private Setting fullAuto = this.register(SettingsManager.b("Full Auto [BETA]", false));
   private Setting autoReopenInventory = this.register(SettingsManager.booleanBuilder("Auto Reopen Inventory").withValue(true).withVisibility(this::lambda$new$1).build());
   private Setting yaw = this.register(SettingsManager.integerBuilder("Yaw").withValue((int)0).withVisibility(this::lambda$new$3).build());
   private boolean justDismounted;
   private Setting autoDisable = this.register(SettingsManager.b("Auto Disable until Full", true));
   private boolean justDuped;
   private Setting range = this.register(SettingsManager.i("Entity Range", 3));
   private Setting triggerable = this.register(SettingsManager.b("Triggerable", true));
   private Setting autoDismount = this.register(SettingsManager.booleanBuilder("Dismounts after autoduping").withValue(true).withVisibility(this::lambda$new$0).build());
   private boolean dismountNextTick;
   private int cooldown;
   private Setting aim = this.register(SettingsManager.b("Aim", false));
   private Setting delay = this.register(SettingsManager.integerBuilder("Delay").withValue((int)3).withVisibility(this::lambda$new$2).build());
   private int donkeyFullness;

   private boolean lambda$new$4(Integer var1) {
      return (Boolean)this.aim.getValue();
   }

   private boolean lambda$new$0(Boolean var1) {
      return (Boolean)this.fullAuto.getValue();
   }

   public AutoDupe() {
      this.cooldown = (Integer)this.delay.getValue();
      this.donkeyFullness = 0;
      this.dismountNextTick = false;
      this.justDuped = false;
      this.justDismounted = false;
   }

   private boolean lambda$new$1(Boolean var1) {
      return (Boolean)this.fullAuto.getValue();
   }

   public void onUpdate() {
      Iterator var1 = mc.field_71441_e.field_72996_f.iterator();

      while(true) {
         Entity var2;
         do {
            do {
               do {
                  do {
                     do {
                        if (!var1.hasNext()) {
                           return;
                        }

                        var2 = (Entity)var1.next();
                     } while(!EntityUtil.isLiving(var2));
                  } while(var2 == mc.field_71439_g);
               } while(mc.field_71439_g.func_70032_d(var2) > (float)(Integer)this.range.getValue());
            } while(((EntityLivingBase)var2).func_110143_aJ() <= 0.0F);
         } while(!(var2 instanceof AbstractChestHorse));

         try {
            if (this.dismountNextTick && this.cooldown < 1) {
               mc.field_71439_g.func_184210_p();
               mc.field_71439_g.field_71174_a.func_147297_a(new CPacketEntityAction(mc.field_71439_g, Action.START_SNEAKING));
               this.justDismounted = true;
               this.dismountNextTick = false;
               this.cooldown = (Integer)this.delay.getValue();
               return;
            }

            if (this.cooldown > 0) {
               --this.cooldown;
               return;
            }

            if ((Boolean)this.fullAuto.getValue() && !this.justDuped && this.justDismounted && (Boolean)this.autoReopenInventory.getValue() && mc.field_71439_g.func_110317_t()) {
               if (this.cooldown > 0) {
                  --this.cooldown;
                  return;
               }

               if (this.cooldown < 1) {
                  try {
                     mc.field_71439_g.func_175163_u();
                     this.cooldown = (Integer)this.delay.getValue();
                     this.justDismounted = false;
                     return;
                  } catch (Exception var6) {
                     return;
                  }
               }
            }

            if (mc.field_71462_r instanceof GuiScreenHorseInventory) {
               Container var3 = ((GuiScreenHorseInventory)mc.field_71462_r).field_147002_h;
               this.donkeyFullness = 0;

               int var4;
               Slot var5;
               for(var4 = 2; var4 <= 16; ++var4) {
                  var5 = var3.func_75139_a(var4);
                  if (var5.func_75216_d() && var5.func_75211_c() != null) {
                     ++this.donkeyFullness;
                  }
               }

               Vec3d var8;
               if ((Boolean)this.fullAuto.getValue()) {
                  if (this.cooldown > 0) {
                     --this.cooldown;
                     return;
                  }

                  if (this.donkeyFullness == 0 && this.justDuped) {
                     this.justDuped = false;
                     mc.field_71439_g.func_71053_j();
                     if ((Boolean)this.autoDismount.getValue()) {
                        this.dismountNextTick = true;
                        return;
                     }
                  }

                  if (this.donkeyFullness == 15 && !this.justDuped) {
                     var8 = new Vec3d(var2.field_70165_t, var2.field_70163_u, var2.field_70161_v);
                     mc.field_71439_g.field_71174_a.func_147297_a(new CPacketUseEntity(var2, EnumHand.MAIN_HAND, var8));
                     this.justDuped = true;
                     return;
                  }

                  if (this.donkeyFullness > 0 && this.justDuped) {
                     if ((Boolean)this.aim.getValue()) {
                        Minecraft.func_71410_x().field_71439_g.field_70177_z = (float)(Integer)this.yaw.getValue();
                        if (Minecraft.func_71410_x().field_71439_g.func_184187_bx() != null) {
                           Minecraft.func_71410_x().field_71439_g.func_184187_bx().field_70177_z = (float)(Integer)this.yaw.getValue();
                        }

                        Minecraft.func_71410_x().field_71439_g.field_70125_A = (float)(Integer)this.pitch.getValue();
                        if (Minecraft.func_71410_x().field_71439_g.func_184187_bx() != null) {
                           Minecraft.func_71410_x().field_71439_g.func_184187_bx().field_70125_A = (float)(Integer)this.pitch.getValue();
                        }
                     }

                     for(var4 = 2; var4 <= 16; ++var4) {
                        ItemStack var9 = (ItemStack)mc.field_71439_g.field_71070_bA.func_75138_a().get(var4);
                        if (!var9.func_190926_b() && var9.func_77973_b() != Items.field_190931_a) {
                           mc.field_71442_b.func_187098_a(mc.field_71439_g.field_71070_bA.field_75152_c, var4, 0, ClickType.PICKUP, mc.field_71439_g);
                           mc.field_71442_b.func_187098_a(mc.field_71439_g.field_71070_bA.field_75152_c, -999, 0, ClickType.PICKUP, mc.field_71439_g);
                           this.cooldown = (Integer)this.delay.getValue();
                           return;
                        }
                     }

                     return;
                  }

                  if (this.donkeyFullness < 15 && !this.justDuped) {
                     for(var4 = 17; var4 < 52; ++var4) {
                        var5 = var3.func_75139_a(var4);
                        if (var5.func_75216_d() && var5.func_75211_c() != null) {
                           mc.field_71442_b.func_187098_a(mc.field_71439_g.field_71070_bA.field_75152_c, var4, 0, ClickType.QUICK_MOVE, mc.field_71439_g);
                           this.cooldown = (Integer)this.delay.getValue();
                           ++var4;
                           return;
                        }
                     }
                  }
               } else {
                  if ((Boolean)this.autoDisable.getValue() && this.donkeyFullness < 15) {
                     return;
                  }

                  var8 = new Vec3d(var2.field_70165_t, var2.field_70163_u, var2.field_70161_v);
                  mc.field_71439_g.field_71174_a.func_147297_a(new CPacketUseEntity(var2, EnumHand.MAIN_HAND, var8));
                  if ((Boolean)this.triggerable.getValue()) {
                     this.disable();
                  }
               }
            }
         } catch (Exception var7) {
         }
      }
   }

   private boolean lambda$new$3(Integer var1) {
      return (Boolean)this.aim.getValue();
   }

   private boolean lambda$new$2(Integer var1) {
      return (Boolean)this.fullAuto.getValue();
   }

   private boolean isValidEntity(Entity var1) {
      if (var1.func_70032_d(mc.field_71439_g) > (float)(Integer)this.range.getValue()) {
         return false;
      } else {
         return var1 instanceof AbstractChestHorse;
      }
   }
}
