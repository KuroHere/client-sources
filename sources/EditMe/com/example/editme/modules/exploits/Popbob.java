package com.example.editme.modules.exploits;

import com.example.editme.commands.Command;
import com.example.editme.events.PacketEvent;
import com.example.editme.modules.Module;
import com.example.editme.settings.Setting;
import com.example.editme.util.client.MathUtil;
import com.example.editme.util.setting.SettingsManager;
import com.mojang.realmsclient.gui.ChatFormatting;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.util.function.Predicate;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.network.Packet;
import net.minecraft.network.play.server.SPacketSoundEffect;
import net.minecraft.util.SoundCategory;
import net.minecraft.util.math.BlockPos;

@Module.Info(
   name = "Popbob",
   category = Module.Category.EXPLOITS
)
public class Popbob extends Module {
   @EventHandler
   private Listener eventPacketReceive = new Listener(this::lambda$new$0, new Predicate[0]);
   private Setting logToFile = this.register(SettingsManager.b("Log to File", true));
   private BlockPos pos;

   private void lambda$new$0(PacketEvent.Receive var1) {
      if (mc.field_71439_g != null) {
         Packet var2 = var1.getPacket();
         BlockPos var3 = null;
         if (var2 instanceof SPacketSoundEffect && ((SPacketSoundEffect)var2).func_186977_b() == SoundCategory.WEATHER) {
            SPacketSoundEffect var4 = (SPacketSoundEffect)var2;
            var3 = new BlockPos(var4.func_149207_d(), var4.func_149211_e(), var4.func_149210_f());
         }

         if (var3 != null) {
            BlockPos var9 = new BlockPos(mc.field_71439_g);
            if (Math.abs(var9.func_177958_n() - var3.func_177958_n()) > 250 || Math.abs(var9.func_177952_p() - var3.func_177952_p()) > 250) {
               this.pos = var3;
            }

            double var5 = (double)MathUtil.wrap((float)(Math.atan2((double)var3.func_177952_p() - mc.field_71439_g.field_70161_v, (double)var3.func_177958_n() - mc.field_71439_g.field_70165_t) * 180.0D / 3.141592653589793D - 90.0D));
            Command.sendRawChatMessage(String.valueOf((new StringBuilder()).append(ChatFormatting.RED.toString()).append("Lighting Strike Detected Towards ").append(var5).append(" (").append(var3.func_177958_n()).append(" ").append(var3.func_177956_o()).append(" ").append(var3.func_177952_p()).append(")")));
            if ((Boolean)this.logToFile.getValue()) {
               try {
                  BufferedWriter var7 = new BufferedWriter(new FileWriter(String.valueOf((new StringBuilder()).append("ThunderExploit").append(mc.func_147104_D().field_78845_b).append(".txt")), true));
                  var7.write(String.valueOf((new StringBuilder()).append(var5).append(",").append(mc.field_71439_g.field_70165_t).append(",").append(mc.field_71439_g.field_70161_v)));
                  var7.newLine();
                  var7.close();
               } catch (IOException var8) {
                  var8.printStackTrace();
               }
            }

         }
      }
   }
}
