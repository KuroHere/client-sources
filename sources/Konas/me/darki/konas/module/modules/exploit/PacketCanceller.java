package me.darki.konas.module.modules.exploit;

import cookiedragon.eventsystem.Subscriber;
import me.darki.konas.event.events.PacketEvent;
import me.darki.konas.module.Module;
import me.darki.konas.setting.Setting;
import net.minecraft.network.play.client.*;

public class PacketCanceller extends Module {
    private Setting<Boolean> packetInput = new Setting<>("CPacketInput", false);
    private Setting<Boolean> packetPlayer = new Setting<>("CPacketPlayer", false);
    private Setting<Boolean> packetEntityAction = new Setting<>("CPacketEntityAction", false);
    private Setting<Boolean> packetUseEntity = new Setting<>("CPacketUseEntity", false);
    private Setting<Boolean> packetVehicleMove = new Setting<>("CPacketVehicleMove", false);

    private int packetsCancelled = 0;
    
    public PacketCanceller() {
        super("PacketCanceller", Category.EXPLOIT);
    }

    public void onUpdate() {
        if (mc.player == null || mc.world == null) {
            toggle();
        }
    }

    public void onEnable() {
        packetsCancelled = 0;
    }

    @Subscriber
    public void onPacketSend(PacketEvent.Send event) {
        if (
                        (packetInput.getValue() && event.getPacket() instanceof CPacketInput)
                        ||
                        (packetPlayer.getValue() && event.getPacket() instanceof CPacketPlayer && mc.player.getRidingEntity() == null)
                        ||
                        (packetEntityAction.getValue() && event.getPacket() instanceof CPacketEntityAction)
                        ||
                        (packetUseEntity.getValue() && event.getPacket() instanceof CPacketUseEntity)
                        ||
                        (packetVehicleMove.getValue() && event.getPacket() instanceof CPacketVehicleMove)
        ) {
            event.cancel();
            packetsCancelled++;
            setExtraInfo(Integer.toString(packetsCancelled));
        }
    }
}
